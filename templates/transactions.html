{% extends "base.html" %}

{% block title %}Transactions - VintageFinance{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="page-header">
                <div class="header-content">
                    <h1 class="vintage-page-title">
                        <i data-feather="list"></i>
                        Transactions
                    </h1>
                    <p class="vintage-page-subtitle">Manage your financial transactions</p>
                </div>
                <div class="header-actions">
                    <a href="{{ url_for('add_transaction') }}" class="btn vintage-btn vintage-btn-primary">
                        <i data-feather="plus"></i>
                        Add Transaction
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Filters -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="vintage-card">
                <div class="vintage-card-body">
                    <form method="GET" class="filter-form">
                        <div class="row g-3 align-items-end">
                            <div class="col-md-4">
                                <label class="vintage-label">Filter by Category</label>
                                <select name="category" class="form-select vintage-form-control">
                                    <option value="">All Categories</option>
                                    {% for category in categories %}
                                        <option value="{{ category.name }}" {{ 'selected' if category_filter == category.name else '' }}>
                                            {{ category.name }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="vintage-label">Filter by Type</label>
                                <select name="type" class="form-select vintage-form-control">
                                    <option value="">All Types</option>
                                    <option value="income" {{ 'selected' if type_filter == 'income' else '' }}>Income</option>
                                    <option value="expense" {{ 'selected' if type_filter == 'expense' else '' }}>Expense</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <div class="filter-buttons">
                                    <button type="submit" class="btn vintage-btn vintage-btn-outline-primary">
                                        <i data-feather="filter"></i>
                                        Apply Filters
                                    </button>
                                    <a href="{{ url_for('transactions') }}" class="btn vintage-btn vintage-btn-outline-secondary">
                                        <i data-feather="x"></i>
                                        Clear
                                    </a>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Transactions List -->
    <div class="row">
        <div class="col-12">
            <div class="vintage-card">
                <div class="vintage-card-body">
                    {% if transactions.items %}
                        <div class="transactions-table">
                            <div class="table-responsive">
                                <table class="table vintage-table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Title</th>
                                            <th>Category</th>
                                            <th>Type</th>
                                            <th>Amount</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for transaction in transactions.items %}
                                        <tr class="transaction-row {{ transaction.transaction_type }}">
                                            <td class="transaction-date">
                                                {{ transaction.transaction_date.strftime('%m/%d/%Y') }}
                                            </td>
                                            <td>
                                                <div class="transaction-title-cell">
                                                    <div class="transaction-title">{{ transaction.title }}</div>
                                                    {% if transaction.description %}
                                                        <div class="transaction-description">{{ transaction.description }}</div>
                                                    {% endif %}
                                                </div>
                                            </td>
                                            <td>
                                                <span class="transaction-category-badge">{{ transaction.category }}</span>
                                            </td>
                                            <td>
                                                <span class="transaction-type-badge {{ transaction.transaction_type }}">
                                                    <i data-feather="{{ 'trending-up' if transaction.transaction_type == 'income' else 'trending-down' }}"></i>
                                                    {{ transaction.transaction_type.title() }}
                                                </span>
                                            </td>
                                            <td class="transaction-amount {{ transaction.transaction_type }}">
                                                {{ "+" if transaction.transaction_type == 'income' else "-" }}${{ "%.2f"|format(transaction.amount) }}
                                            </td>
                                            <td>
                                                <div class="transaction-actions">
                                                    <a href="{{ url_for('edit_transaction', transaction_id=transaction.id) }}" 
                                                       class="btn vintage-btn vintage-btn-outline-primary btn-sm" 
                                                       title="Edit">
                                                        <i data-feather="edit"></i>
                                                    </a>
                                                    <a href="{{ url_for('delete_transaction', transaction_id=transaction.id) }}" 
                                                       class="btn vintage-btn vintage-btn-outline-danger btn-sm" 
                                                       title="Delete"
                                                       onclick="return confirm('Are you sure you want to delete this transaction?')">
                                                        <i data-feather="trash-2"></i>
                                                    </a>
                                                </div>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Pagination -->
                        {% if transactions.pages > 1 %}
                        <nav class="pagination-nav">
                            <ul class="pagination vintage-pagination">
                                {% if transactions.has_prev %}
                                    <li class="page-item">
                                        <a class="page-link" href="{{ url_for('transactions', page=transactions.prev_num, category=category_filter, type=type_filter) }}">
                                            <i data-feather="chevron-left"></i>
                                        </a>
                                    </li>
                                {% endif %}
                                
                                {% for page_num in transactions.iter_pages() %}
                                    {% if page_num %}
                                        <li class="page-item {{ 'active' if page_num == transactions.page else '' }}">
                                            <a class="page-link" href="{{ url_for('transactions', page=page_num, category=category_filter, type=type_filter) }}">
                                                {{ page_num }}
                                            </a>
                                        </li>
                                    {% else %}
                                        <li class="page-item disabled">
                                            <span class="page-link">...</span>
                                        </li>
                                    {% endif %}
                                {% endfor %}
                                
                                {% if transactions.has_next %}
                                    <li class="page-item">
                                        <a class="page-link" href="{{ url_for('transactions', page=transactions.next_num, category=category_filter, type=type_filter) }}">
                                            <i data-feather="chevron-right"></i>
                                        </a>
                                    </li>
                                {% endif %}
                            </ul>
                        </nav>
                        {% endif %}
                        
                    {% else %}
                        <div class="empty-state">
                            <i data-feather="inbox" class="empty-icon"></i>
                            <h4>No transactions found</h4>
                            <p>
                                {% if category_filter or type_filter %}
                                    No transactions match your current filters. Try adjusting your search criteria.
                                {% else %}
                                    You haven't added any transactions yet. Start tracking your finances today!
                                {% endif %}
                            </p>
                            {% if not category_filter and not type_filter %}
                                <a href="{{ url_for('add_transaction') }}" class="btn vintage-btn vintage-btn-primary">
                                    <i data-feather="plus"></i>
                                    Add Your First Transaction
                                </a>
                            {% endif %}
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
